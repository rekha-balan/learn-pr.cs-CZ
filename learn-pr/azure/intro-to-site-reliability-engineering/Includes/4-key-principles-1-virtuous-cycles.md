Pokud je v určitém smyslu pravda, že „jsme to, co děláme“, tak jsme se teď dopracovali k jádru tohoto modulu. V této lekci podíváme na dva postupy, které jsou často považovány za základ praxe SRE. Oba vychází z principu, že je důležité vytvořit „cykly zlepšování“. Cykly zlepšování v tomto kontextu rozumíme postupy, kdy se v organizaci buduje systém zpětné vazby s pozitivním efektem, což organizaci umožňuje průběžně se zlepšovat. Těmto dvěma postupům budou dále věnovány samostatné následné moduly, takže tady si je jen zhruba nastíníme pro přehled.

### <a name="virtuous-cycle-1-slis-and-slos"></a>Cyklus zlepšování č.1: SLI a SLO

Dříve v tomto modulu jsme hovořili o tom, jak je důležité propracovat se k „odpovídající úrovni spolehlivosti“. To je přesně to, k čemu tu směřujeme.

Řekněme, že máte novou službu, kterou plánujete zprovoznit v produkčním prostředí (ať již hotovou, nebo zatím stále v procesu plánování). Důležitou součástí tohoto procesu je učinit rozhodnutí o její požadované spolehlivosti. Pokud nepíšete veškerý kód sami, je naprosto zásadní činit tato rozhodnutí ve spolupráci s vývojáři, kteří na tom budou skutečně pracovat.

První rozhodnutí spočívá v tom, co budete používat jako ukazatele stavu služby (ukazatel úrovně služby – SLI, Service Level Indicator). Jiný způsob položení této otázky je: „Jak poznáte, že všechno funguje tak, jak má?“. Existuje mnoho způsobů, jak tohle sledovat (později se na ně podíváme podrobně). Nicméně obvykle se používají míry založené na úspěchu/selhání (dokončí služba úspěšně určitou operaci v určitém procentu případů), míry založené na časování (vrátí služba odpověď do určitého časového limitu), míry založené na propustnosti (podařilo se zpracovat určitý objem dat) nebo jejich kombinace. Jednoduchý příklad může být, že jako SLI pro naši službu stanovíme, jak často byl vrácen úspěch – signalizováno kódem HTTP 200 (oproti kódu 500 nebo jinému kódu).

Když teď máme jasný ukazatel, jak říct, jestli služba funguje správně, potřebujeme dále rozhodnout, jakou úroveň spolehlivosti si přejeme nebo očekáváme. Očekáváme například, že během období jednoho dne budeme u služby pozorovat míru chybovosti 20 %? Tohle kulaté a velké číslo tu používáme čistě proto, že do začátku se nám tu při vysvětlování s ním bude v příkladech dobře pracovat. V pozdějších modulech zvýšíme složitost a přesnost výroků, jako například „Kteří uživatelé uvidí tuto míru chybovosti? Někteří z nich? Většina ?“ a podobně. Toto očekávání, opět vypracované ve spolupráci s vývojářem služby, je cíl úrovně služby (SLO, Service Level Objective).

SLO musí být něco, co můžete v monitorovacím systému přesně měřit a prezentovat. Má to být cíl, dobře chápaný cíl pro spolehlivost služby – jaké číslo je dostatečné? Žádné spekulace „...přišlo mi, že služba minulý týden docela jela, ale těžko říct...“ Služba buď splňuje své kritérium SLO, nebo ho nesplňuje. Data musí hovořit jasně. Pokud služba své SLO nesplňuje (zejména pokud to nastává opakovaně v delším časovém období), pak je něco špatně a je potřeba to řešit.

### <a name="error-budgets"></a>Rozpočty chyb

Je snadné pochopit, že organizace má podniknout nápravnou akci, když služba neplní své SLO. SRE na tento koncept navazuje a jde o krok dál v případech, kdy služba své SLO plní nebo překračuje. Některé organizace využívají SLO k sestavení takzvaných „rozpočtů chyb“.

Abychom si tuto myšlenku demonstrovali, použijeme ukázkovou službu, kterou jsme probírali, a její SLO 80 % úspěchu (můžeme brát, jako že „musí být v provozu až 80 % času“). SLO 80% provozuschopnosti deklaruje, že naše služba musí být v provozu až 80 % času. Ale co těch zbývajících 20 %? Pokud je naše služba zbývajících 20 % času mimo provoz, moc nám na tom nezáleží, protože jsme rozhodli, že provozuschopnost po těchto dalších 20 % času není pro náš cíl služby důležitá.

Takže pokud nám nezáleží, co se během této doby bude dít, co můžeme se službou dělat? Jednou z věcí, které určitě můžeme dělat, je rozvířit běžící službu tím, že ji upgradujeme, například novou verzí přinášející další funkce. Pokud tato nová verze bude fungovat a nebude způsobovat dodatečné výpadky, skvěle. Pokud tato nová verzi způsobí, že služba bude méně stabilní a bude dalších 10 % času vracet chyby v rámci ladění, je to stále v pořádku. Pohybujeme se v rámci našeho rozpočtu povolené nespolehlivosti.

Rozpočet chyb je rozdíl mezi potenciální perfektní spolehlivostí služby a její žádanou spolehlivostí (100 % - 80 % = 20 %). V tomto případě nám rozpočet chyb přináší fond 20 % nespolehlivost – 20 % času, kdy nám nezáleží na provozuschopnosti, protože služba bude tak jako tak v rámci specifikace.  Těchto 20 % času můžete čerpat a „utrácet“ libovolným způsobem (například s dalšími verzemi) až do vyčerpání, stejně jako u jiných rozpočtů.

Rozpočty chyb se používají také v některých organizacích v méně šťastných případech, když se nedosahuje požadované SLO. V takovém případě budete možná chtít udělat něco trochu více než jenom „podniknout nápravnou akci“, jak je uvedeno výše. Řekněme, že naše služba měla nějaké problémy a byla provozuschopná jen 60 % času, jak nám to signalizují ukazatele SLI, které jsme zvolili dříve. To znamená, že služba nedosáhla svého cíle (SLO). Naše služba vyčerpala svůj rozpočet chyb. Organizace se může rozhodnout odložit plánované vydání nové verze, protože ví, že další modifikace systému by v tuto chvíli pravděpodobně vedly jen k dalšímu zhoršení situace ohledně spolehlivosti. Rozpočty chyb se obvykle počítají pro stanovené období (měsíc, čtvrtletí atd.) a po skončení jednoho rozpočtu na něj hned navazuje další, takže když se pak případně spolehlivost služby zlepší, rozpočty se vrátí do normálu.

V době omezeného uvádění nové verze se organizace může rozhodnout přesměrovat některé technické zdroje z vývoje funkcí na práci na zlepšení spolehlivosti, aby se odhalily (a odstranily) zdroje problémů, které způsobily, že služba nedosáhla stanovené SLO.

Důvod, proč mluvíme v souvislosti s rozpočty chyb o „některých organizacích“, je, že implementace těchto rozpočtů je docela náročná, obzvlášť v případě jejich použití s omezeným uváděním nové verze. Je tedy nutná vyšší úroveň nasazení ze strany organizace, což je ne v každé organizaci splněno. Organizace musí být připravena vydat rozhodnutí, že se vydání nové verze odsouvá, pokud dosud naměřená spolehlivost služby nedostála nárokům. A ne všechny organizace jsou ochotny takové rozhodnutí přijmou. Tohle není jedinou možnou reakcí na vyčerpaný rozpočet chyb, ale je to reakce, o které se nejvíce mluví.

V samostatném modulu budeme ještě mluvit o SLI, SLO a rozpočtech chyb více do podrobností, je ale na místě upozornit u těchto postupů na aspekt cyklu zlepšování. Teto cyklus z hlediska teorie nabízí způsob, jakým mohou organizace popisovat, komunikovat a pracovat na spolehlivosti služby tak, aby se do zlepšení spolehlivosti zapojili všichni. Tento cyklus pozitivní zpětné vazby může být až neuvěřitelně důležitý.

## <a name="virtuous-cycle-2-blameless-postmortems"></a>Cyklus zlepšování č. 2: Analýza po incidentu bez obviňování

Retrospektivní analýza po významné, obvykle nežádoucí, události není samozřejmě výsadou SRE. Ani v normálním provozu není něčím výjimečným. V případě SRE je ovšem kladem obzvláště důraz na specifikum, že tato analýza musí být bez obviňování. Je třeba zaměřit na selhání procesu nebo technologie, které k incidentu vedlo, ne na akce konkrétních lidí. „Kde je problém v našem procesu, že umožnil X udělat tuhle věc, která vedla k selhání? Jaké informace scházely této osobě, nebo je zrovna neměla pohotově před očima v daný moment, že jí to převedlo k nesprávnému závěru? Jaký druh kontroly nebo ochrany by měl být realizován, aby k takovémuto incidentu nemohlo dojít?“ Takovýto typ otázek by měl zaznívat na analýze bez obviňování.

Klíčové je, kam tyto otázky směřují. Snaží se hledat způsoby, jak vylepšit systémy a procesy, nikoli trestat jednotlivce, kteří při používání těchto systémů a procesů v dobré víře přispěli k výpadku. Je důležité si uvědomit, že sice můžete někoho vyhodit, ale rozhodně se neprovyhazujete ke spolehlivému provozu. Naše zkušenost je, že organizace, která po téměř každém produkčním incidentu někoho vyhodí, se z těchto chyb nepoučí. Místo toho skončí s jedním vystrašeným pracovníkem, který se bojí cokoliv změnit.

Naopak fungující proces analýzy po incidentu bez obviňování vede v organizaci k pozitivní zpětné vazbě v cyklu zlepšování. Umožní organizaci poučit se ze selhání a chyb a kontinuálně vylepšovat své systémy (pokud se analýza dělá dobře a její závěry se následně uplatňují a sledují).

Tento vztah k selháním a chybám – že je organizace vnímá jako příležitost k poučení a zlepšení – je jeden z hlavních principů SRE. Dalším je nastavení cyklů zlepšování, aby byly tyto příležitosti řádně využity a organizace směřovala k vyšší spolehlivosti.

V další lekci se podíváme na některé principy a postupy SRE zaměřené na lidskou stránku.
